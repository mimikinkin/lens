<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <meta name="theme-color" content="#0c0c0c"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="LENS"/>
  <title>LENS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}

    :root{
      --bg:      #0c0c0c;
      --bg2:     #141414;
      --bg3:     #1c1c1c;
      --bg4:     #242424;
      --border:  #2a2a2a;
      --border2: #363636;
      --text:    #f4f4f4;
      --text2:   #aaaaaa;
      --text3:   #606060;
      --red:     #c8000a;
      --red-lo:  rgba(200,0,10,0.12);
      --r: 10px;
      --rsm: 7px;
    }

    body{
      background:var(--bg);color:var(--text);
      font-family:'Nunito','Noto Sans JP',sans-serif;
      min-height:100vh;display:flex;flex-direction:column;
      max-width:480px;margin:0 auto;overflow-x:hidden;
      font-size:14px;line-height:1.5;
    }

    /* ━━ HEADER ━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    header{
      display:flex;align-items:center;justify-content:space-between;
      padding:13px 18px 11px;
      border-bottom:1px solid var(--border);
      background:var(--bg);position:sticky;top:0;z-index:300;
      gap:10px;
    }
    .logo{display:flex;align-items:center;gap:10px;flex-shrink:0}
    .dot{
      width:9px;height:9px;background:var(--red);border-radius:50%;flex-shrink:0;
      animation:breathe 3s ease-in-out infinite;
    }
    @keyframes breathe{
      0%,100%{box-shadow:0 0 0 2px rgba(200,0,10,0.1),0 0 8px rgba(200,0,10,0.3)}
      50%{box-shadow:0 0 0 4px rgba(200,0,10,0.06),0 0 16px rgba(200,0,10,0.55)}
    }
    .logo-name{font-size:22px;font-weight:800;letter-spacing:3px;line-height:1}
    .logo-sub{font-size:9px;font-weight:700;letter-spacing:3.5px;color:var(--text3);margin-top:1px}

    .hd-right{display:flex;align-items:center;gap:8px}

    /* language toggle */
    .lang-btn{
      background:var(--bg3);border:1.5px solid var(--border2);
      color:var(--text2);font-family:inherit;font-size:11px;font-weight:700;
      letter-spacing:1px;padding:6px 11px;cursor:pointer;
      border-radius:var(--rsm);transition:all 0.15s;white-space:nowrap;
    }
    .lang-btn:hover{border-color:var(--text3);color:var(--text)}

    .open-btn{
      background:var(--red);color:#fff;border:none;
      padding:8px 17px;font-size:12px;font-weight:700;
      letter-spacing:1px;font-family:inherit;cursor:pointer;
      border-radius:var(--rsm);transition:opacity .15s,transform .1s;
      white-space:nowrap;
    }
    .open-btn:active{opacity:.85;transform:scale(.96)}

    /* ━━ SPLASH ━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    #splash{
      position:fixed;inset:0;z-index:1000;
      background:var(--bg);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      cursor:pointer;
      transition:opacity .55s ease, transform .55s cubic-bezier(.22,1,.36,1);
    }
    #splash.hide{
      opacity:0;transform:scale(1.04);pointer-events:none;
    }
    .splash-lens{
      width:90px;height:90px;
      border:2px solid var(--border2);border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      position:relative;margin-bottom:32px;
      animation:splash-spin 8s linear infinite;
    }
    @keyframes splash-spin{
      from{border-color:var(--border2) var(--border) var(--border) var(--border2)}
      to{border-color:var(--border2) var(--border) var(--border) var(--border2);transform:rotate(360deg)}
    }
    .splash-lens::before{
      content:'';position:absolute;inset:10px;
      border:1.5px solid var(--border);border-radius:50%;
      animation:counter-spin 6s linear infinite;
    }
    @keyframes counter-spin{from{transform:rotate(0)}to{transform:rotate(-360deg)}}
    .splash-lens::after{
      content:'';position:absolute;inset:22px;
      border:1px solid var(--border);border-radius:50%;
    }
    .splash-dot{
      width:12px;height:12px;background:var(--red);border-radius:50%;
      position:relative;z-index:1;
      box-shadow:0 0 0 3px rgba(200,0,10,0.1),0 0 20px rgba(200,0,10,0.5);
      animation:breathe 3s ease-in-out infinite;
    }
    .splash-title{
      font-size:38px;font-weight:800;letter-spacing:8px;
      color:var(--text);margin-bottom:8px;line-height:1;
    }
    .splash-sub{
      font-size:10px;font-weight:700;letter-spacing:4px;
      color:var(--text3);margin-bottom:48px;
    }
    .splash-cta{
      font-size:11px;font-weight:700;letter-spacing:3px;
      color:var(--text3);
      display:flex;align-items:center;gap:10px;
      animation:blink 2s ease-in-out infinite;
    }
    .splash-cta-line{width:24px;height:1px;background:var(--border2)}
    @keyframes blink{0%,100%{opacity:.4}50%{opacity:1}}

    /* ━━ PREVIEW ━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    #preview-area{
      background:var(--bg2);height:260px;
      display:flex;align-items:center;justify-content:center;
      border-bottom:1px solid var(--border);
      position:relative;overflow:hidden;cursor:pointer;flex-shrink:0;
    }
    #pimg{max-width:100%;max-height:260px;object-fit:contain;display:none;transition:filter .25s ease}
    .ph{text-align:center;pointer-events:none;user-select:none}
    .ph-lens{
      width:60px;height:60px;border:1.5px solid var(--border2);border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      margin:0 auto 14px;position:relative;
    }
    .ph-lens::before{content:'';position:absolute;inset:8px;border:1px solid var(--border);border-radius:50%}
    .ph-lens::after{content:'';position:absolute;inset:16px;border:1px solid var(--border);border-radius:50%}
    .ph-dot{width:7px;height:7px;background:var(--red);border-radius:50%}
    .ph-hint{font-size:10px;font-weight:700;letter-spacing:2.5px;color:var(--text3)}
    #vover{position:absolute;inset:0;pointer-events:none;display:none}
    .expbar{position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--border)}
    .expfill{height:100%;background:var(--red);width:50%;transition:width .2s ease}

    /* ━━ TABS ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .tabs{
      display:flex;background:var(--bg);
      border-bottom:1px solid var(--border);
      flex-shrink:0;
    }
    .tab{
      flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:10px 3px 8px;border:none;background:none;
      color:var(--text3);font-family:inherit;font-size:9px;font-weight:700;
      letter-spacing:.5px;cursor:pointer;gap:4px;
      border-bottom:2.5px solid transparent;
      transition:color .2s,border-color .2s;
    }
    .tab.active{color:var(--text);border-bottom-color:var(--red)}
    .tab-icon{font-size:15px;line-height:1}

    /* ━━ PANEL ━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .panel-wrap{flex:1;overflow:hidden;min-height:0}
    .panel{
      display:none;padding:18px 18px 24px;
      overflow-y:auto;height:100%;
      max-height:calc(100vh - 360px);
      animation:rise .22s cubic-bezier(.22,1,.36,1);
    }
    .panel.active{display:block}
    @keyframes rise{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .sec-title{
      font-size:10px;font-weight:700;letter-spacing:3px;
      color:var(--text3);margin-bottom:14px;text-transform:uppercase;
    }
    .panel-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}

    /* ━━ SLIDERS ━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .sl-row{margin-bottom:20px}
    .sl-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:9px}
    .sl-lbl{font-size:12px;font-weight:700;color:var(--text2)}
    .sl-val{
      font-size:13px;font-weight:800;color:var(--text3);
      min-width:40px;text-align:right;transition:color .15s;
      font-variant-numeric:tabular-nums;
    }
    .sl-val.on{color:var(--red)}
    .track-wrap{position:relative;padding:7px 0}
    .track-bg{height:3px;background:var(--bg4);border-radius:3px;position:relative;overflow:hidden}
    .track-fill{position:absolute;top:0;height:3px;background:var(--red);border-radius:3px;pointer-events:none;transition:left .04s,width .04s}
    .track-mid{position:absolute;left:50%;top:0;width:1px;height:3px;background:var(--border2);transform:translateX(-50%)}
    input[type=range]{
      position:absolute;top:0;left:0;width:100%;height:3px;
      opacity:0;cursor:pointer;margin:0;
    }
    .thumb{
      position:absolute;top:50%;
      width:16px;height:16px;background:var(--bg);
      border:2.5px solid var(--red);border-radius:50%;
      transform:translate(-50%,-50%);pointer-events:none;
      transition:left .04s,box-shadow .15s;
    }
    .sl-row:hover .thumb,.sl-row:focus-within .thumb{
      box-shadow:0 0 0 5px var(--red-lo);
    }

    /* ━━ BUTTONS ━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .ghost-btn{
      background:none;border:1.5px solid var(--border2);color:var(--text2);
      font-size:11px;font-weight:700;letter-spacing:.5px;padding:8px 15px;
      cursor:pointer;font-family:inherit;border-radius:var(--rsm);
      transition:border-color .15s,color .15s,background .15s;
    }
    .ghost-btn:hover{border-color:var(--text2);color:var(--text);background:var(--bg3)}
    .solid-btn{
      background:var(--red);color:#fff;border:none;
      font-size:11px;font-weight:700;letter-spacing:.5px;
      padding:9px 18px;cursor:pointer;font-family:inherit;
      border-radius:var(--rsm);transition:opacity .15s,transform .1s;
    }
    .solid-btn:active{opacity:.85;transform:scale(.97)}

    /* ━━ CROP ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .crop-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
    .crop-card{
      border:1.5px solid var(--border);background:var(--bg2);
      padding:14px 16px 12px;cursor:pointer;border-radius:var(--r);
      position:relative;overflow:hidden;
      transition:background .15s,border-color .15s;
    }
    .crop-card::after{
      content:'';position:absolute;bottom:0;left:0;right:0;height:2.5px;
      background:var(--red);border-radius:0 0 2px 2px;
      transform:scaleX(0);transform-origin:left;
      transition:transform .22s cubic-bezier(.22,1,.36,1);
    }
    .crop-card.active{background:var(--bg3);border-color:var(--border2)}
    .crop-card.active::after{transform:scaleX(1)}
    .crop-lbl{font-size:16px;font-weight:800;color:var(--text2);margin-bottom:2px;line-height:1.2}
    .crop-card.active .crop-lbl{color:var(--text)}
    .crop-desc{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.5px}
    .crop-card.active .crop-desc{color:var(--text3)}

    /* ━━ RESOLUTION ━━━━━━━━━━━━━━━━━━━━━━━ */
    .res-row{display:flex;align-items:flex-end;gap:10px;margin-bottom:14px}
    .res-x{color:var(--text3);font-size:18px;font-weight:300;padding-bottom:8px}
    .res-iw{flex:1}
    .inp-lbl{font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--text3);margin-bottom:6px}
    input[type=number],input[type=text]{
      background:var(--bg2);border:1.5px solid var(--border);
      color:var(--text);padding:10px 13px;font-size:13px;font-weight:600;
      font-family:inherit;width:100%;outline:none;
      border-radius:var(--rsm);transition:border-color .15s;
    }
    input:focus{border-color:var(--red)}
    input::placeholder{color:var(--text3)}
    .divider{height:1px;background:var(--border);margin:14px 0}
    .rp-list{display:flex;flex-direction:column;gap:7px}
    .rp{
      display:flex;justify-content:space-between;align-items:center;
      padding:13px 15px;border:1.5px solid var(--border);
      border-radius:var(--r);background:var(--bg2);cursor:pointer;
      position:relative;overflow:hidden;
      transition:background .15s,border-color .15s;
    }
    .rp::before{
      content:'';position:absolute;left:0;top:0;bottom:0;width:3px;
      background:var(--red);border-radius:0 2px 2px 0;
      transform:scaleY(0);transform-origin:bottom;
      transition:transform .2s ease;
    }
    .rp.active{background:var(--bg3);border-color:var(--border2)}
    .rp.active::before{transform:scaleY(1)}
    .rp-name{font-size:13px;font-weight:700;color:var(--text2)}
    .rp.active .rp-name{color:var(--text)}
    .rp-dim{font-size:11px;font-weight:600;color:var(--text3)}

    /* ━━ PRESETS ━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .pi-box{
      background:var(--bg2);border:1.5px solid var(--border);
      padding:16px;margin-bottom:14px;border-radius:var(--r);
      animation:rise .2s ease;
    }
    .pi-btns{display:flex;gap:8px;margin-top:12px}
    .pc{
      display:flex;align-items:center;gap:10px;
      border:1.5px solid var(--border);background:var(--bg2);
      padding:13px 14px;margin-bottom:8px;border-radius:var(--r);
      transition:border-color .15s,background .15s;animation:rise .2s ease;
    }
    .pc:hover{border-color:var(--border2);background:var(--bg3)}
    .pc-info{flex:1;min-width:0}
    .pc-name{font-size:14px;font-weight:700;color:var(--text);margin-bottom:3px;line-height:1.3}
    .pc-meta{font-size:10px;font-weight:600;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .apply-btn{
      background:var(--red);color:#fff;border:none;
      font-size:10px;font-weight:700;letter-spacing:.5px;
      padding:8px 13px;cursor:pointer;font-family:inherit;
      border-radius:var(--rsm);white-space:nowrap;transition:opacity .15s;
    }
    .apply-btn:active{opacity:.8}
    .del-btn{
      border:1.5px solid var(--border);background:none;color:var(--text3);
      font-size:13px;padding:7px 11px;cursor:pointer;font-family:inherit;
      border-radius:var(--rsm);transition:border-color .15s,color .15s;
      line-height:1;
    }
    .del-btn:hover{border-color:var(--red);color:var(--red)}

    /* ━━ INFO ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ */
    .info-row{
      display:flex;justify-content:space-between;align-items:center;
      padding:11px 0;border-bottom:1px solid var(--border);gap:12px;
    }
    .info-lbl{font-size:10px;font-weight:700;letter-spacing:1px;color:var(--text3);flex-shrink:0}
    .info-val{font-size:12px;font-weight:600;color:var(--text2);text-align:right;word-break:break-all}
    .info-val.hi{color:var(--red)}
    .adj-box{
      background:var(--bg2);border:1.5px solid var(--border);
      padding:14px 16px;margin-top:16px;border-radius:var(--r);
    }
    .adj-box-title{font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--text3);margin-bottom:12px}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:2px}
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      border:1.5px solid var(--border2);padding:5px 11px;
      border-radius:20px;font-size:11px;font-weight:700;color:var(--text2);
    }
    .chip-v{color:var(--red);font-weight:800}
    .no-adj{font-size:11px;font-weight:600;color:var(--text3);letter-spacing:.5px}

    /* ━━ EMPTY STATE ━━━━━━━━━━━━━━━━━━━━━━ */
    .empty{text-align:center;padding:48px 0}
    .empty-ring{
      width:48px;height:48px;border:1.5px solid var(--border2);border-radius:50%;
      display:flex;align-items:center;justify-content:center;margin:0 auto 16px;
    }
    .empty-dot2{width:5px;height:5px;background:var(--border2);border-radius:50%}
    .empty-ttl{font-size:12px;font-weight:700;letter-spacing:2px;color:var(--text3);margin-bottom:6px}
    .empty-sub{font-size:11px;font-weight:600;color:#2e2e2e;letter-spacing:.5px}

    /* ━━ BOTTOM BAR ━━━━━━━━━━━━━━━━━━━━━━━ */
    #bottom-bar{
      display:none;flex-direction:row;gap:10px;
      padding:12px 18px;border-top:1px solid var(--border);
      background:var(--bg);flex-shrink:0;
    }
    .reset-btn{
      flex:1;border:1.5px solid var(--border2);background:none;color:var(--text2);
      padding:13px;font-size:12px;font-weight:700;letter-spacing:.5px;cursor:pointer;
      font-family:inherit;border-radius:var(--rsm);
      transition:border-color .15s,color .15s,background .15s;
    }
    .reset-btn:hover{border-color:var(--text2);color:var(--text);background:var(--bg3)}
    .export-btn{
      flex:2;background:var(--red);color:#fff;border:none;
      padding:13px;font-size:13px;font-weight:700;letter-spacing:1px;
      cursor:pointer;font-family:inherit;border-radius:var(--rsm);
      transition:opacity .15s,transform .1s;
    }
    .export-btn:active{opacity:.85;transform:scale(.98)}

    ::-webkit-scrollbar{width:3px}
    ::-webkit-scrollbar-track{background:var(--bg)}
    ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
  </style>
</head>
<body>

<!-- ═══ SPLASH ═══ -->
<div id="splash" onclick="dismissSplash()">
  <div class="splash-lens"><div class="splash-dot"></div></div>
  <div class="splash-title">LENS</div>
  <div class="splash-sub" id="splash-sub">PHOTO EDITOR</div>
  <div class="splash-cta">
    <div class="splash-cta-line"></div>
    <span id="splash-cta-txt">TAP TO BEGIN</span>
    <div class="splash-cta-line"></div>
  </div>
</div>

<!-- ═══ HEADER ═══ -->
<header>
  <div class="logo">
    <div class="dot"></div>
    <div>
      <div class="logo-name">LENS</div>
      <div class="logo-sub" data-i="appSub">PHOTO EDITOR</div>
    </div>
  </div>
  <div class="hd-right">
    <button class="lang-btn" onclick="toggleLang()" id="lang-btn">日本語</button>
    <button class="open-btn" onclick="document.getElementById('fi').click()" data-i="open">OPEN</button>
    <input id="fi" type="file" accept="image/*" style="display:none" onchange="loadImg(event)"/>
  </div>
</header>

<!-- ═══ PREVIEW ═══ -->
<div id="preview-area" onclick="document.getElementById('fi').click()">
  <div class="ph" id="ph">
    <div class="ph-lens"><div class="ph-dot"></div></div>
    <div class="ph-hint" data-i="tapOpen">TAP TO OPEN</div>
  </div>
  <img id="pimg"/>
  <div id="vover"></div>
  <div class="expbar"><div class="expfill" id="expfill"></div></div>
</div>

<!-- ═══ TABS ═══ -->
<div class="tabs">
  <button class="tab active" data-tab="adjust" onclick="sw('adjust')">
    <span class="tab-icon">◫</span><span data-i="tabAdjust">ADJUST</span>
  </button>
  <button class="tab" data-tab="crop" onclick="sw('crop')">
    <span class="tab-icon">⊹</span><span data-i="tabCrop">CROP</span>
  </button>
  <button class="tab" data-tab="resolution" onclick="sw('resolution')">
    <span class="tab-icon">⊟</span><span data-i="tabSize">SIZE</span>
  </button>
  <button class="tab" data-tab="preset" onclick="sw('preset')">
    <span class="tab-icon">◈</span><span data-i="tabPreset">PRESET</span>
  </button>
  <button class="tab" data-tab="info" onclick="sw('info')">
    <span class="tab-icon">◎</span><span data-i="tabInfo">INFO</span>
  </button>
</div>

<!-- ═══ PANELS ═══ -->
<div class="panel-wrap">

  <!-- ADJUST -->
  <div class="panel active" id="panel-adjust">
    <div class="panel-hd">
      <div class="sec-title" style="margin-bottom:0" data-i="colorTone">COLOR & TONE</div>
      <button class="ghost-btn" onclick="resetAll()" data-i="reset">RESET</button>
    </div>
    <div id="sliders"></div>
  </div>

  <!-- CROP -->
  <div class="panel" id="panel-crop">
    <div class="sec-title" data-i="cropFrame">CROP & FRAME</div>
    <div class="crop-grid" id="crop-grid">
      <div class="crop-card active" onclick="pickCrop(this)"><div class="crop-lbl">1:1</div><div class="crop-desc" data-i="square">SQUARE</div></div>
      <div class="crop-card" onclick="pickCrop(this)"><div class="crop-lbl">4:3</div><div class="crop-desc" data-i="standard">STANDARD</div></div>
      <div class="crop-card" onclick="pickCrop(this)"><div class="crop-lbl">16:9</div><div class="crop-desc" data-i="wide">WIDE</div></div>
      <div class="crop-card" onclick="pickCrop(this)"><div class="crop-lbl">3:4</div><div class="crop-desc" data-i="portrait">PORTRAIT</div></div>
      <div class="crop-card" onclick="pickCrop(this)"><div class="crop-lbl">9:16</div><div class="crop-desc" data-i="story">STORY</div></div>
      <div class="crop-card" onclick="pickCrop(this)"><div class="crop-lbl">FREE</div><div class="crop-desc" data-i="custom">CUSTOM</div></div>
    </div>
  </div>

  <!-- SIZE -->
  <div class="panel" id="panel-resolution">
    <div class="sec-title" data-i="outputSize">OUTPUT SIZE</div>
    <div class="res-row">
      <div class="res-iw">
        <div class="inp-lbl" data-i="widthPx">WIDTH px</div>
        <input type="number" id="rw" value="1080" oninput="custRes()"/>
      </div>
      <div class="res-x">×</div>
      <div class="res-iw">
        <div class="inp-lbl" data-i="heightPx">HEIGHT px</div>
        <input type="number" id="rh" value="1080" oninput="custRes()"/>
      </div>
    </div>
    <div class="divider"></div>
    <div class="rp-list" id="rpresets"></div>
  </div>

  <!-- PRESET -->
  <div class="panel" id="panel-preset">
    <div class="panel-hd">
      <div class="sec-title" style="margin-bottom:0" data-i="savedPresets">SAVED PRESETS</div>
      <button class="solid-btn" onclick="showPI()" data-i="saveNew">＋ SAVE</button>
    </div>
    <div id="pi-box" style="display:none" class="pi-box">
      <div class="inp-lbl" data-i="presetName">PRESET NAME</div>
      <input type="text" id="pi-name" data-i-placeholder="presetPlaceholder" placeholder="e.g. Moody Film" style="margin-bottom:10px"/>
      <div class="pi-btns">
        <button class="solid-btn" style="flex:1" onclick="saveP()" data-i="save">SAVE</button>
        <button class="ghost-btn" style="flex:1" onclick="hidePI()" data-i="cancel">CANCEL</button>
      </div>
    </div>
    <div id="plist"></div>
  </div>

  <!-- INFO -->
  <div class="panel" id="panel-info">
    <div class="sec-title" data-i="imageData">IMAGE DATA</div>
    <div id="idata">
      <div class="empty">
        <div class="empty-ring"><div class="empty-dot2"></div></div>
        <div class="empty-ttl" data-i="noImage">NO IMAGE LOADED</div>
        <div class="empty-sub" data-i="openToView">OPEN AN IMAGE TO VIEW DATA</div>
      </div>
    </div>
  </div>

</div>

<!-- ═══ BOTTOM BAR ═══ -->
<div id="bottom-bar">
  <button class="reset-btn" onclick="resetAll()" data-i="reset">RESET</button>
  <button class="export-btn" onclick="doExport()" data-i="export">EXPORT IMAGE</button>
</div>

<canvas id="cv" style="display:none"></canvas>

<script>
/* ── i18n ───────────────────────────────────────── */
const LANG = {
  en: {
    appSub:'PHOTO EDITOR', open:'OPEN', tapOpen:'TAP TO OPEN',
    tabAdjust:'ADJUST', tabCrop:'CUT', tabSize:'SIZE', tabPreset:'PRESET', tabInfo:'INFO',
    colorTone:'COLOR & TONE', reset:'RESET',
    cropFrame:'CUT & FRAME',
    square:'SQUARE', standard:'STANDARD', wide:'WIDE', portrait:'PORTRAIT', story:'STORY', custom:'CUSTOM',
    outputSize:'OUTPUT SIZE', widthPx:'WIDTH px', heightPx:'HEIGHT px',
    savedPresets:'SAVED PRESETS', saveNew:'＋ SAVE', presetName:'PRESET NAME',
    presetPlaceholder:'e.g. Moody Film',
    save:'SAVE', cancel:'CANCEL',
    imageData:'IMAGE DATA', noImage:'NO IMAGE LOADED', openToView:'OPEN AN IMAGE TO VIEW DATA',
    export:'EXPORT IMAGE',
    // slider labels
    slBrightness:'Brightness', slContrast:'Contrast', slSaturation:'Saturation',
    slExposure:'Exposure', slHighlights:'Highlights', slShadows:'Shadows',
    slTemperature:'Temperature', slSharpness:'Sharpness', slVignette:'Vignette',
    // res presets
    rpHD:'HD', rpFHD:'Full HD', rp4K:'4K', rpIG:'Instagram', rpStory:'Story',
    // info labels
    infoFilename:'Filename', infoSize:'File Size', infoType:'Format',
    infoW:'Native Width', infoH:'Native Height', infoMP:'Megapixels',
    infoAR:'Aspect Ratio', infoOutW:'Output Width', infoOutH:'Output Height',
    // preset ui
    applyBtn:'APPLY', deleteBtn:'✕',
    noPresets:'NO PRESETS YET', noPresetsSub:'ADJUST AND SAVE YOUR LOOK',
    activeAdj:'Active Adjustments', noneAdj:'NONE',
    // lang button label (shows what you switch TO)
    langToggle:'日本語',
  },
  ja: {
    appSub:'フォトエディター', open:'開く', tapOpen:'タップして画像を開く',
    tabAdjust:'調整', tabCrop:'カット', tabSize:'サイズ', tabPreset:'プリセット', tabInfo:'情報',
    colorTone:'色調整', reset:'リセット',
    cropFrame:'カット',
    square:'スクエア', standard:'スタンダード', wide:'ワイド', portrait:'ポートレート', story:'ストーリー', custom:'カスタム',
    outputSize:'出力サイズ', widthPx:'横幅 px', heightPx:'縦幅 px',
    savedPresets:'保存済みプリセット', saveNew:'＋ 保存', presetName:'プリセット名',
    presetPlaceholder:'例：モノクロフィルム',
    save:'保存', cancel:'キャンセル',
    imageData:'画像情報', noImage:'画像が読み込まれていません', openToView:'画像を開くと情報が表示されます',
    export:'書き出す',
    // slider labels
    slBrightness:'明るさ', slContrast:'コントラスト', slSaturation:'彩度',
    slExposure:'露出', slHighlights:'ハイライト', slShadows:'シャドウ',
    slTemperature:'色温度', slSharpness:'シャープ', slVignette:'周辺減光',
    // res presets
    rpHD:'HD', rpFHD:'フルHD', rp4K:'4K', rpIG:'Instagram', rpStory:'ストーリー',
    // info labels
    infoFilename:'ファイル名', infoSize:'ファイルサイズ', infoType:'形式',
    infoW:'元の幅', infoH:'元の高さ', infoMP:'メガピクセル',
    infoAR:'アスペクト比', infoOutW:'出力幅', infoOutH:'出力高さ',
    // preset ui
    applyBtn:'適用', deleteBtn:'✕',
    noPresets:'プリセットなし', noPresetsSub:'調整して保存しましょう',
    activeAdj:'適用中の調整', noneAdj:'なし',
    // lang button label
    langToggle:'English',
  }
};

let lang = 'en';

function t(k){ return (LANG[lang][k] || LANG.en[k] || k) }

function applyLang(){
  // update button label
  document.getElementById('lang-btn').textContent = t('langToggle');
  // data-i elements
  document.querySelectorAll('[data-i]').forEach(el=>{
    el.textContent = t(el.dataset.i);
  });
  // placeholders
  document.querySelectorAll('[data-i-placeholder]').forEach(el=>{
    el.placeholder = t(el.dataset.iPlaceholder);
  });
  // re-render dynamic content
  initSliders();
  initRes();
  renderP();
  updInfo();
}

function toggleLang(){
  lang = lang==='en'?'ja':'en';
  applyLang();
  updSplash();
}

/* ── State ──────────────────────────────────────── */
const DEFS={brightness:0,contrast:0,saturation:0,exposure:0,highlights:0,shadows:0,temperature:0,sharpness:0,vignette:0};

function getSliders(){
  return [
    {k:'brightness', lk:'slBrightness', mn:-100,mx:100},
    {k:'contrast',   lk:'slContrast',   mn:-100,mx:100},
    {k:'saturation', lk:'slSaturation', mn:-100,mx:100},
    {k:'exposure',   lk:'slExposure',   mn:-100,mx:100},
    {k:'highlights', lk:'slHighlights', mn:-100,mx:100},
    {k:'shadows',    lk:'slShadows',    mn:-100,mx:100},
    {k:'temperature',lk:'slTemperature',mn:-100,mx:100},
    {k:'sharpness',  lk:'slSharpness',  mn:0,   mx:100},
    {k:'vignette',   lk:'slVignette',   mn:0,   mx:100},
  ];
}
function getResPresets(){
  return [
    {lk:'rpHD',  w:1280, h:720},
    {lk:'rpFHD', w:1920, h:1080},
    {lk:'rp4K',  w:3840, h:2160},
    {lk:'rpIG',  w:1080, h:1080},
    {lk:'rpStory',w:1080,h:1920},
  ];
}

let adj={...DEFS};
let rw=1080,rh=1080;
let imgInfo=null,imgEl=null;
let presets=JSON.parse(localStorage.getItem('lens_v4')||'[]');

/* ── Sliders ─────────────────────────────────────── */
function initSliders(){
  const prev={...adj};
  document.getElementById('sliders').innerHTML=getSliders().map(({k,lk,mn,mx})=>{
    const v=prev[k]||0;
    const pct=((v-mn)/(mx-mn))*100;
    let fillL,fillW;
    if(mn<0){ if(v>=0){fillL='50%';fillW=(pct-50)+'%'}else{fillL=pct+'%';fillW=(50-pct)+'%'} }
    else{fillL='0';fillW=pct+'%'}
    return `<div class="sl-row">
      <div class="sl-top">
        <span class="sl-lbl">${t(lk)}</span>
        <span class="sl-val${v!==0?' on':''}" id="v_${k}">${v>0?'+'+v:v}</span>
      </div>
      <div class="track-wrap">
        <div class="track-bg">
          ${mn<0?'<div class="track-mid"></div>':''}
          <div class="track-fill" id="f_${k}" style="left:${fillL};width:${fillW}"></div>
        </div>
        <div class="thumb" id="th_${k}" style="left:${pct}%"></div>
        <input type="range" min="${mn}" max="${mx}" value="${v}"
          oninput="onSL('${k}',+this.value,${mn},${mx})"/>
      </div>
    </div>`;
  }).join('');
}

function onSL(k,v,mn,mx){
  adj[k]=v;
  const pct=((v-mn)/(mx-mn))*100;
  const ve=document.getElementById('v_'+k);
  ve.textContent=v>0?`+${v}`:v;
  ve.className='sl-val'+(v!==0?' on':'');
  const f=document.getElementById('f_'+k);
  const th=document.getElementById('th_'+k);
  if(mn<0){
    if(v>=0){f.style.left='50%';f.style.width=(pct-50)+'%'}
    else{f.style.left=pct+'%';f.style.width=(50-pct)+'%'}
  }else{f.style.left='0';f.style.width=pct+'%'}
  th.style.left=pct+'%';
  applyFX(); expBar();
}

function applyFX(){
  const el=document.getElementById('pimg');
  const b=1+adj.brightness/100,c=1+adj.contrast/100,s=1+adj.saturation/100;
  const sh=adj.sharpness>0?`contrast(${1+adj.sharpness*0.003})`:'';
  el.style.filter=`brightness(${b}) contrast(${c}) saturate(${s}) ${sh}`;
  const v=document.getElementById('vover');
  if(adj.vignette>0){
    v.style.display='block';
    v.style.background=`radial-gradient(ellipse at center,transparent ${100-adj.vignette*0.6}%,rgba(0,0,0,${adj.vignette/100*.82}) 100%)`;
  }else v.style.display='none';
}

function expBar(){
  document.getElementById('expfill').style.width=(50+adj.exposure/2)+'%';
}

function resetAll(){
  adj={...DEFS};
  getSliders().forEach(({k,mn,mx})=>onSL(k,0,mn,mx));
  document.querySelectorAll('#sliders input[type=range]').forEach(i=>i.value=0);
}

/* ── Image ──────────────────────────────────────── */
function loadImg(e){
  const f=e.target.files[0];if(!f)return;
  const el=document.getElementById('pimg');
  el.onload=()=>{
    document.getElementById('ph').style.display='none';
    el.style.display='block';
    document.getElementById('bottom-bar').style.display='flex';
    imgEl=el;
    imgInfo={name:f.name,size:(f.size/1024).toFixed(1)+' KB',type:f.type,
      w:el.naturalWidth,h:el.naturalHeight,
      mp:((el.naturalWidth*el.naturalHeight)/1e6).toFixed(2),
      ar:(el.naturalWidth/el.naturalHeight).toFixed(3)};
    updInfo();
  };
  el.src=URL.createObjectURL(f);
}

/* ── Tabs ───────────────────────────────────────── */
function sw(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===id));
  document.querySelectorAll('.panel').forEach(p=>p.classList.toggle('active',p.id==='panel-'+id));
}

/* ── Crop ───────────────────────────────────────── */
function pickCrop(el){
  document.querySelectorAll('.crop-card').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
}

/* ── Resolution ─────────────────────────────────── */
function initRes(){
  document.getElementById('rpresets').innerHTML=getResPresets().map(r=>`
    <div class="rp${rw===r.w&&rh===r.h?' active':''}" onclick="pickRes(this,${r.w},${r.h})">
      <span class="rp-name">${t(r.lk)}</span>
      <span class="rp-dim">${r.w} × ${r.h}</span>
    </div>`).join('');
}
function pickRes(el,w,h){
  document.querySelectorAll('.rp').forEach(r=>r.classList.remove('active'));
  el.classList.add('active');rw=w;rh=h;
  document.getElementById('rw').value=w;
  document.getElementById('rh').value=h;
  updInfo();
}
function custRes(){
  rw=+document.getElementById('rw').value;
  rh=+document.getElementById('rh').value;
  document.querySelectorAll('.rp').forEach(r=>r.classList.remove('active'));
  updInfo();
}

/* ── Presets ─────────────────────────────────────── */
function showPI(){
  document.getElementById('pi-box').style.display='block';
  setTimeout(()=>document.getElementById('pi-name').focus(),40);
}
function hidePI(){
  document.getElementById('pi-box').style.display='none';
  document.getElementById('pi-name').value='';
}
function saveP(){
  const n=document.getElementById('pi-name').value.trim();
  if(!n)return;
  presets.push({id:Date.now(),name:n,adj:{...adj}});
  localStorage.setItem('lens_v4',JSON.stringify(presets));
  hidePI();renderP();
}
function delP(id){
  presets=presets.filter(p=>p.id!==id);
  localStorage.setItem('lens_v4',JSON.stringify(presets));
  renderP();
}
function applyP(id){
  const p=presets.find(x=>x.id===id);if(!p)return;
  adj={...p.adj};
  getSliders().forEach(({k,mn,mx})=>{
    const i=document.querySelector(`#sliders input[oninput*="'${k}'"]`);
    if(i)i.value=adj[k];
    onSL(k,adj[k],mn,mx);
  });
  sw('adjust');
}
function renderP(){
  const el=document.getElementById('plist');
  if(!presets.length){
    el.innerHTML=`<div class="empty">
      <div class="empty-ring"><div class="empty-dot2"></div></div>
      <div class="empty-ttl">${t('noPresets')}</div>
      <div class="empty-sub">${t('noPresetsSub')}</div>
    </div>`;
    return;
  }
  el.innerHTML=presets.map(p=>{
    const meta=Object.entries(p.adj).filter(([,v])=>v!==0).slice(0,3)
      .map(([k,v])=>`${k}: ${v>0?'+':''}${v}`).join(' · ')||'DEFAULT';
    return `<div class="pc">
      <div class="pc-info">
        <div class="pc-name">${p.name}</div>
        <div class="pc-meta">${meta}</div>
      </div>
      <button class="apply-btn" onclick="applyP(${p.id})">${t('applyBtn')}</button>
      <button class="del-btn" onclick="delP(${p.id})">${t('deleteBtn')}</button>
    </div>`;
  }).join('');
}

/* ── Info ────────────────────────────────────────── */
function updInfo(){
  const el=document.getElementById('idata');
  if(!imgInfo)return;
  const rows=[
    ['infoFilename',imgInfo.name,false],
    ['infoSize',    imgInfo.size,false],
    ['infoType',    imgInfo.type,false],
    ['infoW',       imgInfo.w+' px',false],
    ['infoH',       imgInfo.h+' px',false],
    ['infoMP',      imgInfo.mp+' MP',true],
    ['infoAR',      imgInfo.ar+' : 1',false],
    ['infoOutW',    rw+' px',false],
    ['infoOutH',    rh+' px',false],
  ];
  const active=Object.entries(adj).filter(([,v])=>v!==0);
  el.innerHTML=
    rows.map(([lk,v,hi])=>`
      <div class="info-row">
        <span class="info-lbl">${t(lk)}</span>
        <span class="info-val${hi?' hi':''}">${v}</span>
      </div>`).join('')+
    `<div class="adj-box">
      <div class="adj-box-title">${t('activeAdj')}</div>
      ${active.length
        ?`<div class="chips">${active.map(([k,v])=>`<span class="chip">${k} <span class="chip-v">${v>0?'+':''}${v}</span></span>`).join('')}</div>`
        :`<span class="no-adj">${t('noneAdj')}</span>`}
    </div>`;
}

/* ── Export ──────────────────────────────────────── */
function doExport(){
  if(!imgEl)return;
  const cv=document.getElementById('cv');
  cv.width=rw;cv.height=rh;
  const ctx=cv.getContext('2d');
  const b=1+adj.brightness/100,c=1+adj.contrast/100,s=1+adj.saturation/100;
  ctx.filter=`brightness(${b}) contrast(${c}) saturate(${s})`;
  ctx.drawImage(imgEl,0,0,rw,rh);
  const a=document.createElement('a');
  a.download='lens_export.jpg';
  a.href=cv.toDataURL('image/jpeg',0.95);
  a.click();
}

/* ── Splash ──────────────────────────────────────── */
function dismissSplash(){
  document.getElementById('splash').classList.add('hide');
}
function updSplash(){
  document.getElementById('splash-sub').textContent = t('appSub');
  document.getElementById('splash-cta-txt').textContent = lang==='ja' ? 'タップして開始' : 'TAP TO BEGIN';
}

/* ── Boot ────────────────────────────────────────── */
initSliders(); initRes(); renderP(); expBar(); updSplash();
</script>
</body>
</html>
